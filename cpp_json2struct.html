<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>从json到struct</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax:{
        inlineMath: [["\\(", "\\)"]],
        displayMath: [['$$','$$'],["\\[","\\]"]],
        processEscapes: true
    },
    "HTML-CSS": {fonts: ["TeX"]},
    TeX: {
        extensions: ["AMSmath.js", "AMSsymbols.js", "noErrors.js", "noUndefined.js"],
        equationNumbers: {autoNumber: "all"},
    }
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cpp_json2struct.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">从json到struct </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ol type="1">
<li><a href="https://github.com/qicosmos/iguana">https://github.com/qicosmos/iguana</a></li>
</ol>
<p>基于静态反射的序列化库，非入侵式，</p>
<p>唯一的风险点就是依赖C++17，gcc 7.50是没有问题的。</p>
<ol type="1">
<li><a href="https://github.com/xyz347/x2struct">https://github.com/xyz347/x2struct</a></li>
</ol>
<p>只需要每个结构体后面加一句话就OK，是目前能找到使用起来最简单的方法了，还能支持必需参数和可选参数。</p>
<p>虽然一个变量仍然要写两边，但是 (1)如果涉及必选和可选，那无可厚非， (2)不用以字符串形式重写，这样就能保证运行不会出错，不会出现字符串写错的问题。</p>
<p>唯一的问题就是该方法是入侵式的，必需在结构体的定义就要依赖x2struct。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;x2struct/x2struct.hpp&quot;</span> <span class="comment">// include this header file</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="keyword">struct </span>User {</div><div class="line">    int64_t id;</div><div class="line">    <span class="keywordtype">string</span>  name;</div><div class="line">    <span class="keywordtype">string</span>  mail;</div><div class="line">    User(int64_t i=0, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; n=<span class="stringliteral">&quot;&quot;</span>, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; m=<span class="stringliteral">&quot;&quot;</span>):id(i),name(n),mail(m){}</div><div class="line">    XTOSTRUCT(O(<span class="keywordtype">id</span>, name, mail)); <span class="comment">// add XTOSTRUCT at the end of struct/class</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>Group {</div><div class="line">    <span class="keywordtype">string</span>  name;</div><div class="line">    int64_t master;</div><div class="line">    vector&lt;User&gt; members;</div><div class="line">    XTOSTRUCT(O(name, master, members)); <span class="comment">//  add XTOSTRUCT at the end of struct/class</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div><div class="line">    Group g;</div><div class="line">    g.name = <span class="stringliteral">&quot;C++&quot;</span>;</div><div class="line">    g.master = 2019;</div><div class="line">    g.members.resize(2);</div><div class="line">    g.members[0] = User(1, <span class="stringliteral">&quot;Jack&quot;</span>, <span class="stringliteral">&quot;jack@x2struct.com&quot;</span>);</div><div class="line">    g.members[1] = User(2, <span class="stringliteral">&quot;Pony&quot;</span>, <span class="stringliteral">&quot;pony@x2struct.com&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordtype">string</span> json = x2struct::X::tojson(g);  <span class="comment">// C++ object to json</span></div><div class="line">    cout&lt;&lt;json&lt;&lt;endl;</div><div class="line"></div><div class="line">    Group n;</div><div class="line">    x2struct::X::loadjson(json, n, <span class="keyword">false</span>); <span class="comment">// json to C++ object</span></div><div class="line">    cout&lt;&lt;n.name&lt;&lt;endl;</div><div class="line"></div><div class="line">    vector&lt;int&gt; vi;</div><div class="line">    x2struct::X::loadjson(<span class="stringliteral">&quot;[1,2,3]&quot;</span>, vi, <span class="keyword">false</span>); <span class="comment">// load vector directory</span></div><div class="line">    cout&lt;&lt;vi.size()&lt;&lt;<span class="charliteral">&#39;,&#39;</span>&lt;&lt;vi[1]&lt;&lt;endl;</div><div class="line"></div><div class="line">    map&lt;int, int&gt; m;</div><div class="line">    x2struct::X::loadjson(<span class="stringliteral">&quot;{\&quot;1\&quot;:10, \&quot;2\&quot;:20}&quot;</span>, m, <span class="keyword">false</span>); <span class="comment">// load map directory</span></div><div class="line">    cout&lt;&lt;m.size()&lt;&lt;<span class="charliteral">&#39;,&#39;</span>&lt;&lt;m[2]&lt;&lt;endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>作者是中国人，200+的星，还是挺厉害的。</p>
<ol type="1">
<li><a href="https://www.codeproject.com/Articles/805182/ZetJsonCpp">https://www.codeproject.com/Articles/805182/ZetJsonCpp</a></li>
</ol>
<p>文档详细，但是仍然要写挺多的重复代码，如下所示</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>{</div><div class="line">    CParserVarInt32&lt;_CONST_CHAR(<span class="stringliteral">&quot;length&quot;</span>)&gt;  m_length;</div><div class="line">    CParserVarBool&lt;_CONST_CHAR(<span class="stringliteral">&quot;use_space&quot;</span>)&gt; m_use_space;</div><div class="line">}tIdent;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line">{</div><div class="line">    <span class="comment">// Default encoding for text</span></div><div class="line">    CParserVarString&lt;_CONST_CHAR(<span class="stringliteral">&quot;encoding&quot;</span>)&gt;         m_encoding;</div><div class="line">    </div><div class="line">    <span class="comment">// Plug-ins loaded at start-up</span></div><div class="line">    CParserVarArrayString&lt;_CONST_CHAR(<span class="stringliteral">&quot;plug-ins&quot;</span>)&gt;      m_plugins;</div><div class="line">        </div><div class="line">    <span class="comment">// Tab indent size</span></div><div class="line">    CParserVarPropertyGroup&lt;tIdent,_CONST_CHAR(<span class="stringliteral">&quot;indent&quot;</span>)&gt; m_indent;</div><div class="line">}tSampleJson;</div></div><!-- fragment --><ol type="1">
<li><a href="https://www.boost.org/doc/libs/1_48_0/doc/html/boost_propertytree/tutorial.html">https://www.boost.org/doc/libs/1_48_0/doc/html/boost_propertytree/tutorial.html</a></li>
</ol>
<p>boost的property_tree库，手写的地方很多，没有c++语言反射，要把每个变量的名字用字符串重写一遍。</p>
<p>基本上就是一个json paser，可用性不高。</p>
<ol type="1">
<li>protobuf</li>
</ol>
<p>需要从协议开始定义，因为其结构体的定义是编译前生成的，并且是“入侵式”的，也就是说你定义结构体的地方必需包含protobuf。 但是定义我们的工程本身可能也是多个模块组成，不一定想要定义结构体的地方也要包含protobuf。</p>
<ol type="1">
<li>chromium/mojo</li>
<li>元编程实现C++结构体这段反射 <a href="https://cloud.tencent.com/developer/article/1522545">https://cloud.tencent.com/developer/article/1522545</a> </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <ul>
    <li class="footer">
      <span id="busuanzi_container_site_pv">
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
    </span>
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
